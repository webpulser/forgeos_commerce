<% unless defined?(level); level = 0; end %>
<ul>
  <% categories.each do |category| %>
    <li onmouseover="$(this).find('span.<%= level %>').show()" onmouseout="$(this).find('span.<%= level %>').hide()">
      <% picture = category.pictures.first %>
      <%= image_tag(picture.public_filename(:thumb)) if picture  %>
      <%= category.name %>
      <span style="display: none;" class="<%= level || 0 %>">
      <%= link_to 'Edit', { :controller => 'admin/categories', :action => 'edit', :id => category.id }%> |
      <%= link_to_remote 'Destroy', :update => 'categories',
        :url => { :controller => 'admin/categories', :action => 'destroy', :id => category.id } %> |
      <%= link_to 'Create sub category', { :controller => 'admin/categories', :action => 'create', :category => { :parent_id => category.id } }%>
      </span>
      <% category.children.each do |child| %>
        <%= render :partial => 'list', :locals => { :categories => [child], :level => (level + 1) } %>
      <% end %>
    </li>
  <% end %>
</ul>
