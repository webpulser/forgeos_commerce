= include_tiny_mce_if_needed

- form_for [:admin, product], :html => { :id => 'wrap' } do |f|
  .backgrounds.big-header
    = f.text_field :name
    .interact-links
      = fg_submit_tag (product.new_record? ? 'product.create.action' :'save_changes')
      = I18n.t('or')
      = link_to I18n.t('cancel').capitalize, admin_products_path, :class => 'back-link'

  #content.grid_16.alpha.omega
    #product.grid_12.alpha
      %h2.permalink
        = I18n.t('permalink').capitalize
        \:
        = "#{request.protocol}#{request.host}/"
        = f.text_field :url
      .grid_9.omega
        .grid_4.alpha.omega
          = f.label :price, "#{I18n.t('price', :count => 1).capitalize}<sup class=\"required\">*</sup>"
          = f.text_field :price, :class => 'backgrounds grid_2 alpha omega', :id => 'price'
          %span.currency
            = $currency.html
        = f.label :product_type_id, "#{I18n.t('product_type', :count => 1).capitalize}<sup class=\"required\">*</sup>"
        .enhanced
          = f.collection_select :product_type_id, ProductType.all, :id, :name, { :prompt => I18n.t('please_select') }
          = observe_field("#{f.object_name}_product_type_id", |
           :frequency => 0.25, |
           :update => "product-types-panel", |
           :url => { :action => :update_tattributes_list }, |
           :with => "'product_type_id='+value") |
        /
          .tool-tip-me
            .stock
              %label{ :for => "product-stock" }
                Stock
              %div
                %select#product-stock{ :name => "product-stock" }
                  %option{ :selected => "selected", :value => "default" }
                    Track low stock level
            #product-in-stock.tool-tip-content
              .content
                %label{ :for => "in-stock" }
                  Products in stock
                %input#in-stock.backgrounds{ :name => "in-stock", :type => "text" }
                %label{ :for => "out-stock-action" }
                  if out of sotck
                %div
                  %select
                    %option{ :selected => "selected", :value => "0" }
                      stop sales
                .clear
            .clear
        %label{ :for => "stock" }
          = I18n.t('stock', :count => 1).capitalize
        = f.text_field 'stock', :class => 'background', :id => 'stock'
      #product-images.grid_3.omega
        #featured-picture
          = I18n.t('picture.featured').capitalize
        = hidden_field_tag "#{f.object_name}[attachment_ids][]"
        %ul.sortable
          - product.pictures.each do |picture|
            %li
              = link_to_function '', "$(this).parents('li').remove()", :title => I18n.t('picture.destroy.confirm').capitalize, :class => 'big-icons trash'
              = link_to '', [:edit, :admin, picture], :class => 'big-icons edit'
              = hidden_field_tag "#{f.object_name}[attachment_ids][]", picture.id
              = image_tag picture.public_filename('')
              .handler
                .inner
          %li.clear
        = link_to content_tag(:span, I18n.t('picture.add').capitalize, :class=>'big-icons add-picture'), {:controller => 'admin/medias', :action => 'new', :target => 'Product', :target_id => product.id}, :class=>'backgrounds button'
      .clear
      .grid_12.omega
        = f.label :description, I18n.t('description').capitalize
        %div{ :style => 'clear: left;'}
          = f.text_area :description, :cols => 80, :class => 'mceEditor'
      .option-panel
        .backgrounds.content-header
        %a.small-icons.panel{ :href => "#" }
          linked files
        .option-panel-content
          %a.backgrounds.button.right{ :href => "#" }
            %span.big-icons.add-file
              = I18n.t('add_file').capitalize
          .grid_9.sortable
            - product.attachments.all(:conditions => ['type != "Picture"']).each do |attachment|
              .block-container
                = hidden_field_tag "#{f.object_name}[attachment_ids][]", attachment.id
                %span.block-type
                  %span.handler
                    %span.inner
                      &nbsp;
                  = attachment.type.to_s.upcase
                %span.block-name
                  = attachment.filename
                  %span.file-size
                    = "- #{attachment.size} Ko"
                %a.big-icons.gray-destroy{:href => '#'}
          .clear
      .option-panel
        .backgrounds.content-header
        %a.small-icons.panel{ :href => "#" }
          = I18n.t('attributes')
        .option-panel-content
          #product-types-panel
            = render :partial => 'admin/tattributes/list_form', :locals => { :product_type => product.product_type, :product => product }
            .clear
      .option-panel.disabled
        .backgrounds.content-header
        %a.small-icons.panel{ :href => "#" }
          variants
        .option-panel-content
          %a.backgrounds.button.right{ :href => "#" }
            %span.small-icons.add-variant
              Create a variant
          .block-container
            %span.block-type
            %span.block-name
              %a.small-icons.panel{ :href => "#" }
                Domaine de Villemont 2008 37cl
            .variant

    #right-sidebar.grid_4.omega
      .step.status.open
        %div
          = f.select :active, [[I18n.t('unpublished'), 0], [I18n.t('published'), 1]], :selected => product.active ? 1 : 0, :class => 'published'
        .clear
        = f.check_box :on_first_page
        = I18n.t('show_on_homepage').capitalize
        %br
        /
          %input#limited-time-offer.check-me-it-appears{ :name => "limited-time-offer", :type => "checkbox" }
          Limited time offer
          .i-will-appear
            %span
              Stop after
              %input#limited-time-offer-end{ :name => "limited-time-offer-end", :type => "text" , :value => 'dd/mm/yyyy'}
          %br
          %input#limited-sales-offer.check-me-it-appears{ :name => "limited-sales-offer", :type => "checkbox" }
          Limited sales offer
          .i-will-appear
            %span
              Stop after
              %input#limited-sales-offer-end{ :name => "limited-sales-offer-end", :type => "text" }
              sales
      .step
        - unless product.new_record?
          = link_to I18n.t('page.duplicate').capitalize, [:duplicate, :admin, product], :class => 'small-icons duplicate'
          = link_to I18n.t('product.destroy.action').capitalize, [:admin, product], :confirm => I18n.t('product.destroy.confirm').capitalize, :method => :delete, :class => 'small-icons delete'
      .step.open
        %a.small-icons.step-title{ :href => "#" }
          Associated to collection
        #association-product-tree.inner-step
          %ul
            = render :partial => 'categories', :locals => { :product => product, :categories => ProductCategory.find_all_by_parent_id(nil) }
          .clear
      .step.open
        %a.small-icons.step-title{ :href => "#" }
          = I18n.t('delivery').capitalize
        .inner-step.weight
          %label{ :for => "weight" }
            = I18n.t('weight').capitalize
            %br
          = f.text_field 'weight', :class => 'product_weight', :id => 'weight'
          KG
          %a.add_size.right.disabled{ :href => "#"}
            Add Size
      .step.open
        %a.small-icons.step-title{ :href => "#" }
          Tags
        .inner-step.tags
          = hidden_field_tag 'tag_list[]', ''
          %input#tag.backgrounds{ :name => "tag", :type => "text" }
          - product.tag_list.each do |tag|
            %span
              = tag
              = hidden_field_tag 'tag_list[]', tag
              = link_to '&nbsp;', '#', :class => 'big-icons gray-destroy'
      .step.open
        %a.small-icons.step-title{ :href => "#" }
          = I18n.t('meta_description').capitalize
        .inner-step.meta
          - product.build_meta_info unless product.meta_info
          - f.fields_for :meta_info do |meta_info|
            %p
              %span
                = I18n.t('title').capitalize
                \:
              = meta_info.text_area :title, :class => 'text'
            %p
              %span
                = I18n.t('description').capitalize
                \:
              = meta_info.text_area :description, :class => 'text'
            %p
              %span
                = I18n.t('keyword', :count => 2).capitalize
                \:
              = meta_info.text_area :keywords, :class => 'text'
      .step.disabled
        %a.small-icons.step-title{ :href => "#" }
          Graphic template
        .inner-step.glossy
          %select{ :name => "design" }
            %option{ :selected => "selected", :value => "default" }
              Corporate blue design
            %option{ :value => "no" }
              Corporate green design
        .clear
    .clear
