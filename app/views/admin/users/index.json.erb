<%
  output = {
    :sEcho => params[:sEcho],
    :iTotalRecords => @users.total_entries || 0,
    :iTotalDisplayRecords => @users.size,
    :aaData => @users.collect do |user|
      klass = user.active? ? 'see-on' : 'see-off'
      [
        content_tag(:div, content_tag(:div, '', :class => 'handler') + content_tag(:div, '', :class => 'small-icons user-ico'), :id => polymorphic_html_id(user), :class => 'handler_container'),
      content_tag(:div, link_to(h(user.fullname), [forgeos_core, :edit, :admin, user]), :class => 'user-name'),
      content_tag(:div, mail_to(h(user.email), user.email, :class => 'truncate', :title => user.email), :class => 'email'),
      user.orders.count,
      user.total_orders.blank? ? t('none').capitalize : content_tag(:div, price_with_currency(user.total_orders)),
      content_tag( :div, (user.orders.empty? ?  t('none').capitalize : user.orders.last(:order => 'created_at DESC' ).created_at.to_date), :class => 'last-date'),
        link_to('', [forgeos_core, :activate, :admin, user],
          :remote => true,
          :class => "small-icons #{klass}",
          :id => polymorphic_html_id(user, 'show')
        ),
        link_to('', [forgeos_core, :edit, :admin, user], :class => 'small-icons edit-link') +
        link_to('', [forgeos_core, :admin, user],
          :remote => true,
          :method => :delete,
          :confirm => t('user.destroy.confirm').capitalize,
          :class => 'small-icons destroy-link',
          :id => polymorphic_html_id(user, 'destroy')
        )
      ]
    end
}
-%>
<%= raw output.to_json -%>
